# Contacts Feature (System-level entity)

## Context
Add a system-level `contacts` entity to store: First, Last, Suffix, Prefix, Address, City, State, Zip, Email, Payment Details (text), Contact Number. Provide a List/Detail UI using existing `ListDetail` pattern with no filters.

## Data Model (Drizzle + SQL)
- Create table and Drizzle schema: `server/src/schema/contacts.ts`
  - Fields:
    - `id` text PK
    - `prefix` text (nullable)
    - `firstName` text (nullable)
    - `lastName` text (nullable)
    - `suffix` text (nullable)
    - `address1` text (nullable)
    - `address2` text (nullable)
    - `city` text (nullable)
    - `state` text (nullable)
    - `postalCode` text (nullable)
    - `email` text (nullable)
    - `paymentDetails` text (nullable)
    - `contactNumber` text (nullable)
    - `updatedAt` timestamptz not null default now()
  - Export `Contact` and `NewContact` types
- Add to schema barrel: `server/src/schema/index.ts` (export `contacts`)
- Migration SQL (Drizzle): add `server/drizzle/<timestamp>_create_contacts.sql`
  - Create table with columns above and primary key on `id`
  - Create simple index on `last_name` and `first_name` for ordering

## API (Hono)
Mount under `/api/v1/contacts` with auth.
- File: `server/src/api.ts`
  - Create `contactsRoutes = new Hono()` and `contactsRoutes.use('*', authMiddleware)`
  - GET `/contacts`:
    - No filters; list all contacts ordered by `lastName`, `firstName`
  - POST `/contacts`:
    - Accept body with fields above
    - Generate `id` via `crypto.randomUUID()` fallback pattern used elsewhere
    - Normalize empty strings to null
    - Basic validations using existing validators where applicable: `isValidEmail`, `isValidState`, `isValidZip5`, `normalizeState`, `normalizeZip5`
  - GET `/contacts/:contactId`:
    - Return one by id or 404
  - PATCH `/contacts/:contactId`:
    - Partial update with same normalization and validations
  - DELETE `/contacts/:contactId`:
    - Delete by id, return 204 or 404
  - Mount: `api.route('/contacts', contactsRoutes)` before the final `app.route('/api/v1', api)`

## Client Types and API Client
- File: `ui/src/lib/serverComm.ts`
  - Add `ContactRecord` interface matching server fields with `updatedAt`
  - Add functions:
    - `listContacts(): Promise<ContactRecord[]>`
    - `createContact(payload): Promise<ContactRecord>`
    - `getContact(id): Promise<ContactRecord>`
    - `updateContact(id, patch): Promise<ContactRecord>`
    - `deleteContact(id): Promise<void>`

## UI - ListDetail View (no filters)
- New page: `ui/src/pages/Contacts.tsx`
  - Use: `ListDetailLayout`, `List`, `CreateInline?` (optional), `useListDetail`, `useDebouncedPatch`
  - Resource adapter implementing:
    - `listItems` -> `listContacts`
    - `getItem` -> `getContact`
    - `createItem` -> `createContact`
    - `patchItem` -> `updateContact`
    - `deleteItem` -> `deleteContact`
  - Left list item label: prefer `lastName, firstName` if present; otherwise any non-empty of `email` or `contactNumber` or `id`
  - Detail form fields (stacked): Prefix, First, Last, Suffix, Address1, Address2, City, State, Zip, Email, Payment Details (textarea), Contact Number
  - No `FilterBar`; omit search/filters entirely
- Ensure exports/imports for shared components are already present via `features/listDetail`

## Navigation
- Add route to router: `ui/src/App.tsx` (or wherever routes are declared)
  - Path: `/contacts` â†’ `Contacts` page
- Add nav link to sidebar/menu if applicable (follow existing pattern)

## Validation/Formatting
- Reuse server validators from `server/src/lib/validators` for email/state/zip; normalize to uppercase for state, 5-digit zip only
- UI can lightly validate (optional): uppercase state, digit-only zip, email format using basic regex or leave to server errors

## Seed/Test Data (optional)
- Add minimal seed creator script or Postman/REST client examples for creating sample contacts

## Notes
- Keep consistent naming with existing employees schema for address/state/zip fields where possible (`address1`, `address2`, `city`, `state`, `postalCode`)
- `contactNumber` is a generic phone field; apply `isValidPhone` and `normalizePhone` if desired
- Future: expand `paymentDetails` into structured fields and link contacts to other entities
