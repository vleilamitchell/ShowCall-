### 0012 — Unify Date/Time Input Interaction (Picker-only)

**Goal (from request):** "make all the date fields in the app work according to the same rules: no text editing of the date by hand. if a user clicks on the field, the calendar comes up. Same rules for time fields."

This plan enforces consistent, picker-only interactions across all date and time fields. Users cannot type into these fields; clicking/focusing the field opens a picker. Values continue to be persisted and sent to the API as `YYYY-MM-DD` for dates and `HH:mm` for times.

---

### Scope and Constraints
- **UI-only interaction change**: Replace free-form text entry with picker-based selection for all date/time inputs.
- **Formats unchanged**: Keep existing formats used across the app and contracts:
  - Dates: `YYYY-MM-DD`
  - Times: `HH:mm` (24-hour) per `server/src/lib/validators.ts` (`isValidDateStr`, `isValidTimeStr`).
- **Disable manual typing**: All date/time fields must be non-editable via keyboard (e.g., `readOnly`, blocked keydown), with value selection strictly via pickers.
- **Picker opens on click/focus**: Clicking/focusing the field (or pressing Enter/Space when focused) opens the calendar/time picker.

---

### Components to Add
Create reusable, controlled components to standardize behavior everywhere:

1) `ui/src/components/date-field.tsx`
   - **Props**: `{ value: string | null; onChange: (v: string | null) => void; disabled?: boolean; placeholder?: string }`
   - **Behavior**:
     - Renders a read-only field that displays the current date in `YYYY-MM-DD` or placeholder when empty.
     - Opens a popover containing a calendar when clicked/focused.
     - On calendar selection, converts the selected Date to `YYYY-MM-DD` and calls `onChange`.
     - Closes popover on selection or on outside click.
   - **Implementation**:
     - Use ShadCN `Popover` + `Calendar` components.
     - Use `date-fns` for formatting/parsing (`format`, `parseISO`).

2) `ui/src/components/time-field.tsx`
   - **Props**: `{ value: string | null; onChange: (v: string | null) => void; disabled?: boolean; stepMinutes?: number; placeholder?: string }`
   - **Behavior**:
     - Renders a read-only field that displays current time in `HH:mm` or placeholder.
     - Opens a popover containing a scrollable list of time options in fixed increments (default 15 minutes: `00:00` to `23:45`).
     - Selecting a time calls `onChange` with `HH:mm` and closes the popover.
   - **Implementation**:
     - Use ShadCN `Popover` + `ScrollArea` (or `Command`) to present options.
     - Generate options on mount from `stepMinutes`.

Accessibility: Both components should open on Enter/Space when focused and trap focus within the popover while open.

---

### Dependencies and UI Kit
- Add ShadCN components if not already present:
  - `calendar`, `popover`, `scroll-area` (and `button`/`input` if needed) via `npx shadcn add ...`
- Add `date-fns` to format/parse dates consistently.

Commands to run (do not commit in plan):
```bash
pnpm --filter ui add date-fns
npx shadcn add calendar popover scroll-area
```

---

### Files/Locations to Update
Replace existing `input`/`Input` date/time fields with new controlled components:

- `ui/src/pages/Events.tsx`
  - New Event form:
    - Replace `<Input type="date" ... value={form.date} ... />` with `<DateField value={form.date} onChange={(v) => setForm({ ...form, date: v ?? '' })} />`.
    - Replace `<Input type="time" ... value={form.startTime} ... />` with `<TimeField value={form.startTime} onChange={(v) => setForm({ ...form, startTime: v ?? '' })} />`.
    - Replace `<Input type="time" ... value={form.endTime} ... />` with `<TimeField value={form.endTime} onChange={(v) => setForm({ ...form, endTime: v ?? '' })} />`.
  - Inline/selected item editor:
    - Replace `<Input type="date" value={selected.date} ... />` with `<DateField value={selected.date} onChange={(v) => { /* keep existing mutateItems + onDateChange */ }} />`.
    - Replace `<Input type="time" value={selected.startTime} ... />` and `endTime` similarly with `<TimeField ... />`.

- `ui/src/pages/Scheduling.tsx`
  - Create schedule modal/section:
    - Replace `<input type="date" value={newScheduleStart} ... />` with `<DateField value={newScheduleStart} onChange={setNewScheduleStart} />`.
    - Replace `<input type="date" value={newScheduleEnd} ... />` with `<DateField value={newScheduleEnd} onChange={setNewScheduleEnd} />`.
  - Create shift panel:
    - Replace `<input type="date" value={newShiftDate} ... />` with `<DateField value={newShiftDate} onChange={setNewShiftDate} />`.
  - Edit shift drawer/panel:
    - Replace date input at the "Date" field with `<DateField value={record.date} onChange={(v) => setRecord({ ...record, date: v ?? '' })} />`.
    - Replace start/end time inputs with `<TimeField value={record.startTime} onChange={(v) => setRecord({ ...record, startTime: v ?? '' })} />` and same for `endTime`.

- `ui/src/lib/serverComm.ts`
  - No changes to types or API contracts; continue using `date: string` (`YYYY-MM-DD`), `startTime: string`, `endTime: string` (`HH:mm`). Ensure UI components always emit strings in these formats.

- `server/src/lib/validators.ts`
  - No changes required; `isValidDateStr` and `isValidTimeStr` already validate the target formats.

---

### Detailed Interaction Rules (to implement in components)
- **No text editing**: Render the visual field using a non-editable element (`readOnly`), prevent key presses that would alter text, and open the popover on click/focus.
- **Open behavior**: Click or Enter/Space opens the popover. Clicking outside or selecting a value closes it.
- **Value mapping**:
  - Date: Internally convert between `string | null` and `Date | undefined`. On select, emit `format(selectedDate, 'yyyy-MM-dd')`.
  - Time: Generate `HH:mm` options. On select, emit the chosen `HH:mm` string.
- **Disabled state**: When `disabled`, do not open popover and render subdued styles.
- **Placeholders**: Show provided placeholder or defaults like `Select date` / `Select time`.

---

### Step-by-step Algorithms
1) DateField
   1. Accept `value` as `string | null`.
   2. Derive a `Date | undefined` via `value ? parseISO(value) : undefined`.
   3. Render a button-like field showing `value` (or placeholder), with `aria-haspopup="dialog"` and `readOnly` semantics.
   4. On click/focus, open `Popover` with `Calendar`.
   5. On calendar selection, compute `format(date, 'yyyy-MM-dd')`, call `onChange(formatted)`, then close.

2) TimeField
   1. Accept `value` as `string | null` and `stepMinutes` (default 15).
   2. Precompute time options from 0:00 to 23:59 stepping by `stepMinutes` and format to `HH:mm`.
   3. Render a button-like field showing `value` (or placeholder), with `aria-haspopup="listbox"`.
   4. On click/focus, open `Popover` with a scrollable list (via `ScrollArea`).
   5. On selecting an option, call `onChange(option)`, then close.

---

### Edge Cases and Notes
- Respect existing business rules (e.g., in `Scheduling.tsx` the date may be validated against schedule range; keep that logic intact).
- If needed, add a clear control for emptying values; otherwise, maintain current non-null assumptions (existing code uses non-empty strings).
- Time increments can be adjusted via `stepMinutes` if product later requests different granularity.

---

### Phased Execution
- Phase 1 — Foundations
  - Add `date-fns` dependency to `ui`.
  - Add required ShadCN components (`calendar`, `popover`, `scroll-area`).
  - Implement `DateField` and `TimeField` components.

- Phase 2 — Apply in Events UI
  - Replace date/time inputs in `ui/src/pages/Events.tsx` with the new components.

- Phase 3 — Apply in Scheduling UI
  - Replace schedule date range, new shift date, and shift edit date/time fields in `ui/src/pages/Scheduling.tsx`.

- Phase 4 — QA and Cleanup
  - Verify formatting and validation round-trips to API.
  - Confirm no remaining `type="date"`/`type="time"` inputs in the UI codebase.

---

### Verification Checklist
- Clicking any date field opens a calendar; keyboard typing does not alter the field.
- Clicking any time field opens a time list; keyboard typing does not alter the field.
- Selected values are emitted as `YYYY-MM-DD` and `HH:mm`.
- Existing validations and API calls continue to succeed without change.


