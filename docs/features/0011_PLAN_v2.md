Make Schedule button + auto-generate shifts for events (v2)

Context
- Add a "make schedule" button at the top of the list area in the Schedule view. Clicking it should roll down a creation dialog where a user can define Start/End dates (with week/month presets) and a Name. On submit: create a Schedule, then generate Shifts for all Events in the date range for the selected Department, attaching those Shifts to the Schedule.

Decisions (from answers)
- Department scope: single department only (use currently selected Department; block if none selected).
- Length input: Start/End dates with presets for week/month.
- Presets specifics: Week = Start + 6 days (inclusive); Month = end of the Start month (inclusive), including month-end cases.
- Shift title: copy Event title into Shift title.
- Re-running generation: prompt user if existing Shifts for (schedule, department). On confirm, delete Assignments for those Shifts, then delete the Shifts, then create new Shifts; if Schedule has been published, fail and instruct to unpublish first.
- Event filtering: include all Events within date range regardless of status.

Scope
- UI: `ui/src/pages/Scheduling.tsx`
- Client API: `ui/src/lib/serverComm.ts`
- Server API: `server/src/api.ts`
- Validators/utilities: `server/src/lib/validators.ts`

UI changes (Scheduling view)
- Location: Top of left list panel (near search/department + New shift toggle). Add a secondary button: "Make schedule".
- Behavior: Clicking toggles an inline creation panel (roll-down) matching the existing inline creator styles.
- Fields:
  - Name (required)
  - Start date (required, YYYY-MM-DD)
  - End date (required, YYYY-MM-DD; must be â‰¥ start)
  - Department (required): defaults to currently selected Department; disabled if none selected, with helper text.
  - Presets: Week (End = Start + 6 days), Month (End = last day of Start month).
- Submission flow:
  1) Call `createSchedule({ name, startDate, endDate })`.
  2) If created, pre-check existing shifts via `listShifts(departmentId, { scheduleId })`.
     - If any exist, prompt: "Replace existing shifts for this schedule?" If confirmed, call `generateShiftsForSchedule(scheduleId, { departmentId, regenerate: true })`. If cancelled, abort.
     - If none exist, call `generateShiftsForSchedule(scheduleId, { departmentId })`.
  3) Refresh schedules (`listSchedules`) and shifts (use current filters; include `scheduleId` when applicable) and close panel. Show success toast/inline message.
- Error handling: Inline validation messages, API error banner, disable submit while saving.

Client API additions (`ui/src/lib/serverComm.ts`)
- Function: `generateShiftsForSchedule(scheduleId: string, payload: { departmentId: string; regenerate?: boolean })`
  - POST `/api/v1/schedules/:scheduleId/generate-shifts`
  - Returns `{ created: number, skipped: number, shifts: ShiftRecord[] }`
- Add to `api` export: `api.generateShiftsForSchedule`.

Server API additions (`server/src/api.ts`)
- Endpoint: `POST /api/v1/schedules/:scheduleId/generate-shifts`
  - Auth: protected.
  - Body: `{ departmentId: string; regenerate?: boolean }`
  - Steps:
    1) Load schedule by id; 404 if not found. Validate `startDate`/`endDate` with `isValidDateStr` and ensure `startDate â‰¤ endDate`.
    2) If `regenerate` is true: if `schedule.isPublished` is true, return 409 (cannot regenerate published schedule). Otherwise, delete all Assignments linked to Shifts with `(scheduleId, departmentId)`, then delete those Shifts.
    3) Fetch events with `events.date >= startDate` and `events.date <= endDate` (inclusive), ordered by `date`, `startTime`.
    4) For each event:
       - If `regenerate` is true, skip existence check (since deleted). Else, check if a shift exists for `(scheduleId, eventId, departmentId)` and skip if present (idempotent).
       - Insert shift `{ id, departmentId, scheduleId, eventId, date: event.date, startTime: event.startTime, endTime: event.endTime, title: event.title }`.
    5) Respond with `{ created, skipped, shifts }` and 201.
  - Implementation notes:
    - Wrap in a transaction for deleting (when `regenerate`) and creating.
    - Use existing ID generation pattern used for shifts.

Files/functions to change
- `ui/src/pages/Scheduling.tsx`
  - Add Make schedule button and roll-down panel with local state: `creatingSchedule`, `name`, `startDate`, `endDate`.
  - Require `filters.departmentId`; disable button or show helper when absent.
  - Submit handler implements the flow above and refreshes lists on success.

- `ui/src/lib/serverComm.ts`
  - Add `export async function generateShiftsForSchedule(scheduleId: string, payload: { departmentId: string; regenerate?: boolean })` and attach as `api.generateShiftsForSchedule`.

- `server/src/api.ts`
  - Under schedules routes, add `POST /schedules/:scheduleId/generate-shifts` per above.

Algorithms
1) Validate inputs (dates, department id presence).
2) Load schedule; guard `regenerate` for published schedules.
3) Fetch events in `[startDate, endDate]`.
4) For each event, insert a department-scoped shift attached to the schedule (copying event title and times); skip duplicates when not regenerating.
5) Return created/ skipped counts and created shift records.

Edge cases and decisions
- No department selected: disable Make schedule button and show helper text in panel.
- Empty events in range: success with 0 created.
- Regenerate attempts on published schedule: 409 with message to unpublish first.
- Performance: acceptable to perform per-event checks initially; consider batching later if needed.




