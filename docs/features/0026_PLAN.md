### Feature: Introduce Unit Testing Across UI and Server

Brief description
- Add fast, isolated unit testing with TypeScript for both `ui` (React + Vite) and `server` (Hono + TypeScript).
- Use Vitest as the common test runner to keep tooling cohesive. Use React Testing Library and user-event for UI component tests. Use supertest-like fetch mocks and Hono test utilities for server route/logic tests.

Phase 0 — Repository-wide conventions
- Test file naming: `*.test.ts` and `*.test.tsx` colocated next to source files.
- Coverage thresholds (initial): lines 60%, functions 60%, branches 50% (to be raised later).
- Common scripts at workspace root are not required; tests will be run per package: `cd ui && pnpm test`, `cd server && pnpm test`.

Phase 1 — Server (Hono) unit tests
Context
- Server already declares a test script and dev dependency on Vitest in `server/package.json`.
- Key code areas: `server/src/services/**`, `server/src/routes/**`, `server/src/lib/**`, `server/src/middleware/**`.

Changes
1) Add Vitest config
- Create `server/vitest.config.ts` to enable TS, node environment, and coverage.
- Configure `test.globals` true, `environment: 'node'`, `coverage` with `provider: 'v8'` and include `src/**/*.ts`.

2) Add helpers/mocks
- Create `server/src/test/setup.ts` for any global mocks (e.g., env vars via `dotenv/config`, Firebase Admin stubs if needed).
- If DB functions in `server/src/lib/db.ts` are imported directly by services, introduce light dependency seams:
  - Export smaller functions and mock with `vi.mock('.../lib/db')` in tests.

3) Targeted first tests (to validate setup)
- `server/src/services/events/recurrence.ts`: pure function logic → unit tests for weekday masks and date generation.
- `server/src/services/inventory/validation.ts`: unit tests for validation outcomes.
- `server/src/routes/eventSeries.ts`: Hono route handler test using Hono’s `app.request()` and mocked dependencies.

4) Scripts
- In `server/package.json` ensure scripts:
  - `"test": "vitest"`
  - `"test:watch": "vitest --watch"`
  - `"test:coverage": "vitest run --coverage"`

Notes
- Avoid hitting real Neon/Supabase. Use `vi.mock` for `postgres` and `drizzle-orm` calls or test pure service-layer logic by faking repository functions.
- Use small fixtures colocated under `__fixtures__` when needed.

Phase 2 — UI unit tests (React + Vite)
Context
- UI uses Vite + React 19, Tailwind, ShadCN. No current test runner.

Changes
1) Add dependencies to `ui/package.json`
- `pnpm add -D vitest @vitest/coverage-v8 @testing-library/react @testing-library/user-event @testing-library/jest-dom @types/testing-library__jest-dom jsdom`

2) Add Vitest config
- Create `ui/vitest.config.ts` using `defineConfig` with:
  - `plugins: [react()]`
  - `test: { environment: 'jsdom', setupFiles: './src/test/setup.ts', globals: true, coverage: { provider: 'v8', include: ['src/**/*.{ts,tsx}'], exclude: ['src/main.tsx'] } }`

3) Add test setup
- Create `ui/src/test/setup.ts` to import `@testing-library/jest-dom` and to polyfill globals if needed.

4) Initial test targets
- Components: `components/ui/button.tsx`, `components/navbar.tsx`, `components/login-form.tsx`.
- Hooks: `features/listDetail/hooks/useDebouncedPatch.ts`, `hooks/use-mobile.ts`.
- Utility modules: `lib/utils.ts`, `lib/time.ts`.

5) Scripts
- Add scripts in `ui/package.json`:
  - `"test": "vitest"`
  - `"test:watch": "vitest --watch"`
  - `"test:coverage": "vitest run --coverage"`

Phase 3 — API client contract tests (UI side)
- For `ui/src/lib/serverComm.ts`, create unit tests that:
  - mock `fetch` and `getAuth(app)` to return a fake token.
  - verify headers and URLs constructed (e.g., `Authorization: Bearer <token>`, base URL from `import.meta.env.VITE_API_URL`).
  - assert error path throws `APIError` with status and message when `response.ok` is false.

Phase 4 — CI integration (optional, fast follow)
- Add a root `scripts/test-all` npm script that runs both:
  - `"test:all": "pnpm -C server test && pnpm -C ui test"`
- Add GitHub Actions workflow `.github/workflows/test.yml` to run `pnpm install` then `pnpm -C server test` and `pnpm -C ui test` on pushes/PRs.

Specific files to add or change
- Server
  - Add: `server/vitest.config.ts`
  - Add: `server/src/test/setup.ts`
  - New tests under: `server/src/**/__tests__/*.test.ts` and/or colocated `*.test.ts` near modules like `services/events/recurrence.ts` and `routes/eventSeries.ts`.
  - Ensure `server/package.json` scripts (test/test:watch/test:coverage) exist.
- UI
  - Add: `ui/vitest.config.ts`
  - Add: `ui/src/test/setup.ts`
  - Add initial tests for: `components/ui/button.tsx`, `components/navbar.tsx`, `components/login-form.tsx`, `features/listDetail/hooks/useDebouncedPatch.ts`, `hooks/use-mobile.ts`, `lib/utils.ts`, `lib/time.ts`, and `lib/serverComm.ts`.
  - Ensure `ui/package.json` scripts (test/test:watch/test:coverage) exist.

Algorithms / testing approaches
- Prefer pure-function tests first (deterministic, no I/O). For side-effectful modules:
  - Use dependency injection or `vi.mock` to isolate DB and network.
  - For Hono routes, instantiate app, register a single route, send synthetic requests, and assert on JSON bodies/status codes.
  - For React components, use Testing Library: render, interact with `userEvent`, assert via accessible roles and text content.

Rollout plan
- Commit the config and a few smoke tests to prove the harness.
- Add tests opportunistically as you touch code; increase coverage thresholds incrementally.

Notes about environment
- No .env changes are required for unit tests. If tests rely on `VITE_API_URL`, configure via Vitest `define` or set `import.meta.env` in the test setup file for UI tests.
